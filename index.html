<!DOCTYPE html>
<html lang="am">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Kids Math Challenge!</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap');

  :root {
    --primary-color: #3498db;
    --secondary-color: #2ecc71;
    --wrong-color: #e74c3c;
    --light-bg: #ecf0f1;
    --dark-text: #2c3e50;
  }

  body {
    background: linear-gradient(135deg, #6dd5ed 0%, #2193b0 100%);
    font-family: 'Nunito', sans-serif;
    padding: 20px;
    overflow: hidden;
    color: var(--dark-text);
  }

  .game-wrapper {
    display: flex;
    max-width: 900px;
    margin: 20px auto;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 25px;
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.18);
  }

  /* --- Player Sidebar --- */
  .player-sidebar {
    width: 250px;
    padding: 20px;
    border-right: 2px solid var(--light-bg);
  }
  .player-sidebar h2 {
    text-align: center;
    margin-top: 0;
  }
  .player-card {
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 10px;
    transition: all 0.3s ease;
  }
  .player-card.active {
    background-color: var(--primary-color);
    color: white;
    transform: scale(1.05);
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.5);
  }
  .player-info {
    display: flex;
    justify-content: space-between;
    font-weight: bold;
    font-size: 1.1em;
  }
  .progress-bar-container {
    background-color: #e0e0e0;
    border-radius: 10px;
    height: 10px;
    margin-top: 5px;
    overflow: hidden;
  }
  .progress-bar {
    width: 0%;
    height: 100%;
    background-color: var(--secondary-color);
    transition: width 0.5s ease-in-out;
  }
  .player-card.active .progress-bar {
    background-color: white;
  }

  /* --- Main Game Area --- */
  .game-container {
    flex-grow: 1;
    padding: 20px 40px;
    text-align: center;
  }

  #current-player-turn {
    font-size: 1.5em;
    font-weight: bold;
  }

  #question {
    font-size: 2.2em;
    min-height: 100px;
    margin: 20px 0;
    color: var(--primary-color);
    font-weight: 700;
  }

  input[type="number"] {
    width: 50%;
    padding: 12px;
    border-radius: 10px;
    border: 2px solid #ddd;
    text-align: center;
    font-size: 1.5em;
    margin-bottom: 15px;
  }
  
  button {
    background-color: var(--secondary-color);
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 10px;
    font-size: 18px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
  }
  button:hover {
    background-color: #27ae60;
    transform: scale(1.05);
  }
  #muteBtn {
    background-color: var(--wrong-color); position: fixed;
    top: 15px; right: 15px; z-index: 100;
  }

  /* --- Winner Screen --- */
  #winner-screen {
    display: none; /* Hidden by default */
    text-align: center;
    padding: 40px;
  }
  #winner-name {
    font-size: 3em;
    color: #f1c40f;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
  }
  #dancing-char {
    width: 250px;
    height: 250px;
    margin: 20px auto;
  }

  /* --- Animations --- */
  .star {
    position: absolute; top: -20px; color: gold; font-size: 24px;
    animation: fall 3s linear; pointer-events: none;
  }
  @keyframes fall {
    to { transform: translateY(100vh); opacity: 0; }
  }
  .shake {
    animation: shake 0.5s;
  }
  @keyframes shake {
    10%, 90% { transform: translate3d(-1px, 0, 0); }
    20%, 80% { transform: translate3d(2px, 0, 0); }
    30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
    40%, 60% { transform: translate3d(4px, 0, 0); }
  }

  @media (max-width: 768px) {
    .game-wrapper {
        flex-direction: column;
    }
    .player-sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 2px solid var(--light-bg);
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }
    .player-card {
        width: 120px;
    }
  }

</style>
</head>
<body>

<audio id="background-music" src="abdu-kiyar-bye-bye.mp3" loop></audio>

<button id="muteBtn" onclick="toggleMute()">Mute</button>

<div class="game-wrapper">
  <div class="player-sidebar" id="player-sidebar">
    <h2>Players</h2>
  </div>

  <div class="game-container" id="game-container">
    <h1 id="current-player-turn"></h1>
    <div id="question-box">
      <h3 id="question"></h3>
      <input type="number" id="answer" placeholder="·àò·àç·àµ·àÖ·äï ·ä•·ãö·àÖ ·ä†·àµ·åà·â£">
      <br>
      <button onclick="checkAnswer()">Submit</button>
    </div>
  </div>

  <div id="winner-screen">
    <h1>üèÜ ·àª·àù·çí·ãÆ·äï! üèÜ</h1>
    <img id="dancing-char" src="https://media.tenor.com/a2sP52-0i7EAAAAi/minions-dance.gif" alt="Dancing Character">
    <h2 id="winner-name"></h2>
    <button onclick="initializeGame()">Play Again</button>
  </div>
</div>

<script>
// --- DOM Elements ---
const gameWrapper = document.querySelector('.game-wrapper');
const gameContainer = document.getElementById('game-container');
const winnerScreen = document.getElementById('winner-screen');
const playerSidebar = document.getElementById('player-sidebar');
const currentPlayerTurnEl = document.getElementById('current-player-turn');
const questionEl = document.getElementById('question');
const answerEl = document.getElementById('answer');
const winnerNameEl = document.getElementById('winner-name');
const muteBtn = document.getElementById('muteBtn');
const backgroundMusic = document.getElementById('background-music');

// --- Game State & Config ---
const playerNames = ["Faruk", "Mursi", "Veronica", "Selamn", "Hafiz"];
let players = [];
let currentPlayerIndex = 0;
let correctAnswer = 0;
let isMuted = false;
let winnerSoundInterval = null;
const TOTAL_QUESTIONS_PER_PLAYER = 10;

const compliments = [
  "·åé·â†·ãù!", "·àç·ä≠ ·äê·àÖ!", "·â†·å£·àù ·å•·à©!", "·â†·âµ·ä≠·ä≠·àç!", "·ä†·äï·â∞ ·â†·å£·àù ·åé·â†·ãù ·äê·àÖ!",
  "·çà·å£·äï ·äê·àÖ!", "·ä§·ä≠·à∞·àà·äï·âµ!", "·ä†·äï·â∞ ·åÄ·åç·äì ·äê·àÖ!", "·å•·à© ·ä†·àµ·â∞·à≥·à∞·â• ·äê·ãç!", "·ãã·ãç!",
  "·ä†·åà·äò·ä∏·ãç!", "·ä†·äï·â∞ ·äÆ·ä®·â• ·äê·àÖ!", "·åç·à©·àù ·äê·ãç!"
];

const amharicWordProblems = [
  { q: "·çã·à©·ä≠ 5 ·çñ·àù ·ä†·àà·ãç·ç§ ·àô·à≠·à≤ 3 ·å®·àò·à®·àà·âµ·ç¢ ·çã·à©·ä≠ ·ä†·àÅ·äï ·àµ·äï·âµ ·çñ·àù ·ä†·àà·ãç?", a: 8 },
  { q: "·ãõ·çç ·àã·ã≠ 10 ·ãà·çé·âΩ ·äê·â†·à©·ç¢ 4·â± ·â†·à®·à©·ç¢ ·àµ·äï·âµ ·ãà·çé·âΩ ·âÄ·à©?", a: 6 },
  { q: "·â¨·àÆ·äí·ä´ 2 ·à≥·å•·äñ·âΩ ·ä†·àè·âµ·ç¢ ·ä•·ã´·äï·ã≥·äï·ã± ·à≥·å•·äï ·ãç·àµ·å• 6 ·ä•·à≠·à≥·à∂·âΩ ·ä†·àâ·ç¢ ·â†·å†·âÖ·àã·àã ·àµ·äï·âµ ·ä•·à≠·à≥·à∂·âΩ ·ä†·àâ?", a: 12 },
  { q: "·à∞·àã·àù·äï 15 ·â•·à≠·â±·ä´·äï ·åà·ãù·â∂ 5·â±·äï ·àà·åì·ã∞·äû·âπ ·à∞·å†·ç¢ ·àµ·äï·âµ ·â•·à≠·â±·ä´·äï ·âÄ·à®·ãç?", a: 10 },
  { q: "·ä†·äï·ãµ ·àò·ä™·äì 4 ·åé·àõ·ãé·âΩ ·ä†·àâ·âµ·ç¢ 3 ·àò·ä™·äì·ãé·âΩ ·â†·ãµ·àù·à© ·àµ·äï·âµ ·åé·àõ·ãé·âΩ ·ä†·àè·â∏·ãç?", a: 12 },
  { q: "·â†·ä†·äï·ãµ ·ä≠·çç·àç 7 ·ãà·äï·ã∂·âΩ ·ä•·äì 8 ·à¥·â∂·âΩ ·ä†·àâ·ç¢ ·â†·ä≠·çç·àâ ·ãç·àµ·å• ·â†·å†·âÖ·àã·àã ·àµ·äï·âµ ·â∞·àõ·à™·ãé·âΩ ·ä†·àâ?", a: 15 }
];


// --- Sound Functions ---
function speak(text, lang = "am-ET") {
  if (isMuted) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = lang;
  speechSynthesis.speak(utter);
}

function toggleMute() {
  isMuted = !isMuted;
  backgroundMusic.muted = isMuted;
  muteBtn.innerText = isMuted ? "Unmute" : "Mute";
  if (isMuted) {
    speechSynthesis.cancel();
    if(winnerSoundInterval) clearInterval(winnerSoundInterval);
  }
}

// --- UI & Game Flow Functions ---
function renderPlayerList() {
    playerSidebar.innerHTML = '<h2>Players</h2>';
    players.forEach((player, index) => {
        const card = document.createElement('div');
        card.className = 'player-card';
        if (index === currentPlayerIndex) {
            card.classList.add('active');
        }
        const progress = (player.questionCount / TOTAL_QUESTIONS_PER_PLAYER) * 100;
        card.innerHTML = `
            <div class="player-info">
                <span>${player.name}</span>
                <span>${player.score}</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" style="width: ${progress}%;"></div>
            </div>
        `;
        playerSidebar.appendChild(card);
    });
}

function initializeGame() {
    if(winnerSoundInterval) clearInterval(winnerSoundInterval);
    players = playerNames.map(name => ({ name, score: 0, questionCount: 0 }));
    currentPlayerIndex = 0;
    
    winnerScreen.style.display = 'none';
    gameWrapper.style.display = 'flex';
    
    startTurn();
}

function startTurn() {
    renderPlayerList();
    const currentPlayer = players[currentPlayerIndex];
    currentPlayerTurnEl.innerText = `${currentPlayer.name}'s Turn (${currentPlayer.questionCount + 1}/${TOTAL_QUESTIONS_PER_PLAYER})`;
    generateQuestion();
}

function generateQuestion() {
    answerEl.value = "";
    answerEl.focus();

    const currentPlayer = players[currentPlayerIndex];
    let questionText = "";
    
    // 25% chance of a word problem
    if (Math.random() < 0.25) {
        const problem = amharicWordProblems[Math.floor(Math.random() * amharicWordProblems.length)];
        questionText = problem.q;
        correctAnswer = problem.a;
    } else {
        // --- INCREASING DIFFICULTY for number problems ---
        let a, b, result;
        const qNum = currentPlayer.questionCount;

        if (qNum < 3) { // Easy: Rounds 1-3
            a = Math.floor(Math.random() * 10) + 1;
            b = Math.floor(Math.random() * 10) + 1;
            correctAnswer = a + b; questionText = `${a} + ${b}`;
        } else if (qNum < 7) { // Medium: Rounds 4-7
            a = Math.floor(Math.random() * 20) + 5;
            b = Math.floor(Math.random() * 15) + 1;
            const op = ["+", "-", "√ó"][Math.floor(Math.random() * 3)];
            if (op === "+") { correctAnswer = a + b; questionText = `${a} + ${b}`; }
            if (op === "-") { correctAnswer = Math.max(a, b) - Math.min(a, b); questionText = `${Math.max(a, b)} - ${Math.min(a, b)}`; }
            if (op === "√ó") { a = Math.floor(Math.random() * 8) + 2; b = Math.floor(Math.random() * 8) + 2; correctAnswer = a * b; questionText = `${a} √ó ${b}`; }
        } else { // Hard: Rounds 8-10
            a = Math.floor(Math.random() * 50) + 10;
            b = Math.floor(Math.random() * 50) + 10;
            const op = ["+", "-", "√ó", "√∑"][Math.floor(Math.random() * 4)];
            if (op === "+") { correctAnswer = a + b; questionText = `${a} + ${b}`; }
            if (op === "-") { correctAnswer = Math.max(a, b) - Math.min(a, b); questionText = `${Math.max(a, b)} - ${Math.min(a, b)}`; }
            if (op === "√ó") { a = Math.floor(Math.random() * 10) + 3; b = Math.floor(Math.random() * 10) + 3; correctAnswer = a * b; questionText = `${a} √ó ${b}`; }
            if (op === "√∑") { a = Math.floor(Math.random() * 10) + 2; b = Math.floor(Math.random() * 10) + 2; result = a * b; correctAnswer = b; questionText = `${result} √∑ ${a}`; }
        }
    }
    
    questionEl.innerText = questionText;
    const speakText = questionText.replace('√ó', ' ·à≤·â£·ãõ ').replace('√∑', ' ·à≤·ä´·çà·àç ').replace('+', ' ·à≤·ã∞·àò·à≠ ').replace('-', ' ·à≤·âÄ·äê·àµ ');
    speak("·å•·ã´·âÑ·ç• " + speakText);
}

function checkAnswer() {
    if (backgroundMusic.paused && !isMuted) {
        backgroundMusic.volume = 0.1;
        backgroundMusic.play().catch(e => console.log("Music autoplay prevented."));
    }

    const userAnswer = parseInt(answerEl.value, 10);
    const questionBox = document.getElementById('question-box');

    if (userAnswer === correctAnswer) {
        const currentPlayer = players[currentPlayerIndex];
        currentPlayer.score++;
        currentPlayer.questionCount++;
        
        const randomCompliment = compliments[Math.floor(Math.random() * compliments.length)];
        speak(randomCompliment);
        createStars();
        
        if (isGameOver()) {
            endGame();
        } else {
            nextTurn();
        }
    } else {
        speak("·âµ·ä≠·ä≠·àç ·ä†·ã≠·ã∞·àà·àù, ·ä•·äï·ã∞·åà·äì ·àû·ä≠·à≠");
        questionBox.classList.add('shake');
        setTimeout(() => questionBox.classList.remove('shake'), 500);
    }
}

function nextTurn() {
    // Only advance turn if current player has finished their question
    if (players[currentPlayerIndex].questionCount >= TOTAL_QUESTIONS_PER_PLAYER) {
        // Find the next player who hasn't finished
        let nextPlayerFound = false;
        for(let i = 1; i < players.length; i++) {
            let nextIndex = (currentPlayerIndex + i) % players.length;
            if (players[nextIndex].questionCount < TOTAL_QUESTIONS_PER_PLAYER) {
                currentPlayerIndex = nextIndex;
                nextPlayerFound = true;
                break;
            }
        }
    } else {
         // Move to next player in cycle
        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
    }
    startTurn();
}

function isGameOver() {
    return players.every(p => p.questionCount >= TOTAL_QUESTIONS_PER_PLAYER);
}

function endGame() {
    backgroundMusic.pause();
    
    // Find winner(s)
    let highScore = -1;
    let winners = [];
    players.forEach(player => {
        if (player.score > highScore) {
            highScore = player.score;
            winners = [player.name];
        } else if (player.score === highScore) {
            winners.push(player.name);
        }
    });

    const winnerText = winners.join(' and ');
    winnerNameEl.innerText = winnerText;
    
    gameWrapper.style.display = 'none';
    winnerScreen.style.display = 'block';

    const winnerCompliment = `·ä†·äï·â∞ ·àª·àù·çí·ãÆ·äï ·äê·àÖ! ·â†·å£·àù ·ä†·àµ·åà·à´·àö ·äê·ãç! ·ä•·äï·ä≥·äï ·ã∞·àµ ·ä†·àà·àÖ ${winnerText}!`;
    speak(winnerCompliment);

    // Call winner name repeatedly for 5 seconds
    if (!isMuted) {
        winnerSoundInterval = setInterval(() => {
            speak(winnerText);
        }, 1500);
        setTimeout(() => {
            clearInterval(winnerSoundInterval);
        }, 5000);
    }
}

function createStars() {
  for (let i = 0; i < 20; i++) {
    const star = document.createElement("div");
    star.className = "star";
    star.innerHTML = "‚ú®";
    star.style.left = `${Math.random() * 100}%`;
    star.style.animationDuration = `${Math.random() * 2 + 3}s`;
    star.style.animationDelay = `${Math.random() * 0.5}s`;
    document.body.appendChild(star);
    star.addEventListener('animationend', () => star.remove());
  }
}

// --- Initial Game Start ---
initializeGame();

// Allow submitting with the Enter key
answerEl.addEventListener("keyup", function(event) {
    if (event.key === "Enter") {
        event.preventDefault();
        checkAnswer();
    }
});
</script>
</body>
</html>
